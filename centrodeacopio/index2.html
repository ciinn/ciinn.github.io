<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>Employee</title>
    <script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDdyNPLXZAJ0oFzBkol8qri9CZe3TJc2hw"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js"></script>
  </head>
  <style type="text/css" media="all">
    html, body {
      height: 100%;
      width: 100%;
      margin: 0;
    }

    #map {
      height: 100%;
      width: 100%;
    }
  </style>
  <body onload="initMap()">
    <script type="text/javascript">
      window.ZIPCODES = [
        { "name": 'ITESM Campus Laguna',"latitude":25.5180309,"longitude":-103.4007654, "google_maps_address": 'https://www.google.com/maps/place/ITESM,+Campus+Laguna,+CIMTEC/@25.5180309,-103.4007654,17z/data=!3m1!4b1!4m5!3m4!1s0x868fdb7ddaee179f:0x5c53a564151e5b36!8m2!3d25.5180309!4d-103.3985767' },
        { "name": 'Cruz Roja Torreon',"latitude":25.5369731,"longitude":-103.4365865, "google_maps_address": 'https://www.google.com/maps/place/Cruz+Roja/@25.5369731,-103.4365865,17z/data=!3m1!4b1!4m5!3m4!1s0x868fdbc216f04891:0xcbbab62d884fa93b!8m2!3d25.5369731!4d-103.4343978' }
      ];

      window.info_windows = [];

      var map;
      function initMap() {
        counter = _.countBy(window.ZIPCODES, 'name');

        map = new google.maps.Map(document.getElementById('map'), {
          center: { lat: 25.548597, lng: -103.4719567 },
          zoom: 12
        });

        var markers = window.ZIPCODES.map(function(location, i) {
          marker = new google.maps.Marker({
            map: map,
            url: location['name'],
            position: { lat: location['latitude'], lng: location['longitude'] },
            icon: 'https://door.cratebind.com/dot.svg'
          });

          var infowindow = new google.maps.InfoWindow({
            content: '<div id="content"> <a href="'+location['google_maps_address']+'" target="_blank">'+location['name']+'</a></div>'
          });

          window.info_windows.push(infowindow);

          google.maps.event.addListener(marker, 'click', function() {
            _.each(window.info_windows, function(i){ i.close(); });
            infowindow.open(map, this);
          })
          return marker;
        });

        image_cluster = 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m';
        var markerCluster = new MarkerClusterer(map, markers, {maxZoom: 10, imagePath: image_cluster});
      }
    </script>
    <div id="map"></div>
  </body>
</html>
